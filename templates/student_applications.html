{% extends "base.html" %}

{% block title %}{{ student.name }} - Applications{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>üìù Job Applications</h1>
        <p class="subtitle">{{ student.name }} ({{ student.roll_number }})</p>
        <a href="{{ url_for('student_profile', student_id=student.id) }}" class="btn btn-secondary">‚Üê Back to Profile</a>
    </div>

    <!-- Add New Application Form -->
    <div class="card">
        <h2>Add New Application</h2>
        <form method="POST" class="form">
            <div class="form-row">
                <div class="form-group">
                    <label for="company_name">Company Name *</label>
                    <input type="text" id="company_name" name="company_name" required>
                </div>
                <div class="form-group">
                    <label for="position">Position *</label>
                    <input type="text" id="position" name="position" required placeholder="e.g., Software Engineer">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="application_date">Application Date *</label>
                    <input type="date" id="application_date" name="application_date" required>
                </div>
                <div class="form-group">
                    <label for="status">Status *</label>
                    <select id="status" name="status" required>
                        <option value="applied">Applied</option>
                        <option value="pending">Pending</option>
                        <option value="accepted">Accepted ‚úì</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="job_type">Job Type</label>
                    <select id="job_type" name="job_type">
                        <option value="">-- Select --</option>
                        <option value="internship">Internship</option>
                        <option value="full-time">Full-Time</option>
                        <option value="part-time">Part-Time</option>
                        <option value="contract">Contract</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="location">Location</label>
                    <input type="text" id="location" name="location" placeholder="e.g., Bangalore, Remote">
                </div>
            </div>

            <div class="form-group">
                <label for="package_offered">Package/Stipend Offered</label>
                <input type="text" id="package_offered" name="package_offered" placeholder="e.g., 12 LPA, $50k/year, 20k/month">
            </div>

            <div class="form-group">
                <label for="notes">Notes</label>
                <textarea id="notes" name="notes" rows="3" placeholder="Additional notes, interview rounds, etc."></textarea>
            </div>

            <button type="submit" class="btn btn-primary">Add Application</button>
        </form>
    </div>

    <!-- Applications List -->
    <div class="applications-list">
        <h2>Application History ({{ applications|length }})</h2>
        
        {% if applications %}
            <!-- Summary Stats -->
            <div class="stats-summary">
                <div class="stat-box">
                    <span class="stat-value">{{ applications|selectattr('status', 'equalto', 'applied')|list|length }}</span>
                    <span class="stat-label">Applied</span>
                </div>
                <div class="stat-box success">
                    <span class="stat-value">{{ applications|selectattr('status', 'equalto', 'accepted')|list|length }}</span>
                    <span class="stat-label">Accepted</span>
                </div>
                <div class="stat-box warning">
                    <span class="stat-value">{{ applications|selectattr('status', 'equalto', 'pending')|list|length }}</span>
                    <span class="stat-label">Pending</span>
                </div>
                <div class="stat-box danger">
                    <span class="stat-value">{{ applications|selectattr('status', 'equalto', 'rejected')|list|length }}</span>
                    <span class="stat-label">Rejected</span>
                </div>
            </div>

            {% for app in applications %}
            <div class="card application-card status-{{ app.status }}">
                <div class="app-header">
                    <div>
                        <h3>{{ app.company_name }}</h3>
                        <p class="position">{{ app.position }}</p>
                    </div>
                    <span class="badge badge-{{ app.status }}">{{ app.status|upper }}</span>
                </div>
                
                <div class="app-details">
                    <div class="detail-item">
                        <strong>Applied:</strong> {{ app.application_date.strftime('%B %d, %Y') }}
                    </div>
                    {% if app.job_type %}
                    <div class="detail-item">
                        <strong>Type:</strong> {{ app.job_type|title }}
                    </div>
                    {% endif %}
                    {% if app.location %}
                    <div class="detail-item">
                        <strong>Location:</strong> {{ app.location }}
                    </div>
                    {% endif %}
                    {% if app.package_offered %}
                    <div class="detail-item">
                        <strong>Package:</strong> {{ app.package_offered }}
                    </div>
                    {% endif %}
                </div>

                {% if app.notes %}
                <div class="app-notes">
                    <strong>Notes:</strong>
                    <p>{{ app.notes }}</p>
                </div>
                {% endif %}

                <div class="app-actions">
                    <form method="POST" action="{{ url_for('delete_application', student_id=student.id, app_id=app.id) }}" onsubmit="return confirm('Are you sure you want to delete this application?');">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p>üì≠ No applications recorded yet. Add your first application above!</p>
            </div>
        {% endif %}
    </div>
</div>

<style>
.stats-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin: 2rem 0;
}

.stat-box {
    background: #f5f5f5;
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
    border-left: 4px solid #666;
}

.stat-box.success {
    border-left-color: #28a745;
    background: #d4edda;
}

.stat-box.warning {
    border-left-color: #ffc107;
    background: #fff3cd;
}

.stat-box.danger {
    border-left-color: #dc3545;
    background: #f8d7da;
}

.stat-box .stat-value {
    display: block;
    font-size: 2rem;
    font-weight: bold;
    color: #333;
}

.stat-box .stat-label {
    display: block;
    font-size: 0.9rem;
    color: #666;
    margin-top: 0.25rem;
}

.application-card {
    margin-bottom: 1rem;
}

.app-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 1rem;
}

.app-header h3 {
    margin: 0;
    color: #333;
}

.app-header .position {
    color: #666;
    margin: 0.25rem 0 0 0;
}

.badge-applied {
    background: #6c757d;
}

.badge-pending {
    background: #ffc107;
    color: #000;
}

.badge-accepted {
    background: #28a745;
}

.badge-rejected {
    background: #dc3545;
}

.app-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.5rem;
    margin: 1rem 0;
}

.detail-item {
    font-size: 0.9rem;
}

.detail-item strong {
    color: #555;
}

.app-notes {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 4px;
    margin: 1rem 0;
}

.app-notes p {
    margin: 0.5rem 0 0 0;
    color: #666;
}

.app-actions {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #eee;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}
