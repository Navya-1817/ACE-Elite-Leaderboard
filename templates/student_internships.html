{% extends "base.html" %}

{% block title %}{{ student.name }} - Internships{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>üíº Internships</h1>
        <p class="subtitle">{{ student.name }} ({{ student.roll_number }})</p>
        <a href="{{ url_for('student_profile', student_id=student.id) }}" class="btn btn-secondary">‚Üê Back to Profile</a>
    </div>

    <!-- Add New Internship Form -->
    <div class="card">
        <h2>Add New Internship</h2>
        <form method="POST" class="form">
            <div class="form-row">
                <div class="form-group">
                    <label for="company_name">Company Name *</label>
                    <input type="text" id="company_name" name="company_name" required>
                </div>
                <div class="form-group">
                    <label for="position">Position *</label>
                    <input type="text" id="position" name="position" required placeholder="e.g., Software Development Intern">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="start_date">Start Date *</label>
                    <input type="date" id="start_date" name="start_date" required>
                </div>
                <div class="form-group">
                    <label for="end_date">End Date</label>
                    <input type="date" id="end_date" name="end_date">
                    <label class="checkbox-label">
                        <input type="checkbox" id="is_ongoing" name="is_ongoing" onchange="toggleEndDate()">
                        Currently Working
                    </label>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="work_mode">Work Mode</label>
                    <select id="work_mode" name="work_mode">
                        <option value="">-- Select --</option>
                        <option value="remote">Remote</option>
                        <option value="on-site">On-site</option>
                        <option value="hybrid">Hybrid</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="location">Location</label>
                    <input type="text" id="location" name="location" placeholder="City, Country">
                </div>
            </div>

            <div class="form-group">
                <label for="stipend">Stipend</label>
                <input type="text" id="stipend" name="stipend" placeholder="e.g., 15,000/month, Unpaid, $500/week">
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="4" placeholder="Describe your work, projects, responsibilities, and achievements..."></textarea>
            </div>

            <div class="form-group">
                <label for="skills_used">Skills Used</label>
                <input type="text" id="skills_used" name="skills_used" placeholder="e.g., Python, React, AWS, MongoDB">
            </div>

            <div class="form-group">
                <label for="certificate_url">Certificate URL (if available)</label>
                <input type="url" id="certificate_url" name="certificate_url" placeholder="https://...">
            </div>

            <button type="submit" class="btn btn-primary">Add Internship</button>
        </form>
    </div>

    <!-- Internships List -->
    <div class="internships-list">
        <h2>My Internships ({{ internships|length }})</h2>
        
        {% if internships %}
            {% for internship in internships %}
            <div class="card internship-card {% if internship.is_ongoing %}ongoing{% endif %}">
                <div class="internship-header">
                    <div>
                        <h3>{{ internship.company_name }}</h3>
                        <p class="position">{{ internship.position }}</p>
                    </div>
                    {% if internship.is_ongoing %}
                    <span class="badge badge-success">Ongoing</span>
                    {% endif %}
                </div>
                
                <div class="internship-timeline">
                    <div class="timeline-item">
                        <strong>Duration:</strong>
                        {{ internship.start_date.strftime('%b %Y') }} - 
                        {% if internship.is_ongoing %}
                        Present
                        {% elif internship.end_date %}
                        {{ internship.end_date.strftime('%b %Y') }}
                        {% else %}
                        Not specified
                        {% endif %}
                    </div>
                    
                    {% if internship.location or internship.work_mode %}
                    <div class="timeline-item">
                        {% if internship.work_mode %}
                        <span class="badge badge-secondary">{{ internship.work_mode|title }}</span>
                        {% endif %}
                        {% if internship.location %}
                        üìç {{ internship.location }}
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    {% if internship.stipend %}
                    <div class="timeline-item">
                        <strong>Stipend:</strong> {{ internship.stipend }}
                    </div>
                    {% endif %}
                </div>

                {% if internship.description %}
                <div class="internship-description">
                    <strong>Description:</strong>
                    <p>{{ internship.description }}</p>
                </div>
                {% endif %}

                {% if internship.skills_used %}
                <div class="internship-skills">
                    <strong>Skills:</strong>
                    {% for skill in internship.skills_used.split(',') %}
                    <span class="skill-tag">{{ skill.strip() }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                {% if internship.certificate_url %}
                <div class="internship-cert">
                    <a href="{{ internship.certificate_url }}" target="_blank" class="btn btn-sm btn-secondary">üìú View Certificate</a>
                </div>
                {% endif %}

                <div class="internship-actions">
                    <form method="POST" action="{{ url_for('delete_internship', student_id=student.id, internship_id=internship.id) }}" onsubmit="return confirm('Are you sure you want to delete this internship?');">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p>üíº No internships recorded yet. Add your first internship above!</p>
            </div>
        {% endif %}
    </div>
</div>

<style>
.internship-card {
    margin-bottom: 1rem;
    border-left: 4px solid #6c757d;
}

.internship-card.ongoing {
    border-left-color: #28a745;
}

.internship-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 1rem;
}

.internship-header h3 {
    margin: 0;
    color: #333;
}

.internship-header .position {
    color: #666;
    margin: 0.25rem 0 0 0;
    font-weight: 500;
}

.internship-timeline {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 4px;
    margin: 1rem 0;
}

.timeline-item {
    margin: 0.5rem 0;
    font-size: 0.9rem;
}

.internship-description {
    margin: 1rem 0;
}

.internship-description p {
    margin: 0.5rem 0 0 0;
    color: #666;
    line-height: 1.6;
}

.internship-skills {
    margin: 1rem 0;
}

.skill-tag {
    display: inline-block;
    background: #e9ecef;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.85rem;
    margin: 0.25rem 0.25rem 0.25rem 0;
    color: #495057;
}

.internship-cert {
    margin: 1rem 0;
}

.internship-actions {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #eee;
}

.badge-success {
    background: #28a745;
}

.badge-secondary {
    background: #6c757d;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.checkbox-label {
    display: block;
    margin-top: 0.5rem;
    font-size: 0.9rem;
}

.checkbox-label input {
    margin-right: 0.5rem;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
function toggleEndDate() {
    const isOngoing = document.getElementById('is_ongoing').checked;
    const endDateInput = document.getElementById('end_date');
    
    if (isOngoing) {
        endDateInput.value = '';
        endDateInput.disabled = true;
    } else {
        endDateInput.disabled = false;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const startDateInput = document.getElementById('start_date');
    const endDateInput = document.getElementById('end_date');
    
    startDateInput.addEventListener('change', function() {
        endDateInput.min = this.value;
    });
});
</script>
{% endblock %}
