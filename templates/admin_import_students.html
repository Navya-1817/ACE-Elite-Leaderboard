{% extends "base.html" %}

{% block title %}Import Students - Admin{% endblock %}

{% block content %}
<div class="import-container">
    <div class="page-header">
        <h1>üì• Import Student Data</h1>
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
    </div>
    
    <div class="info-card">
        <h3>‚ÑπÔ∏è Import Instructions</h3>
        <ol>
            <li>Prepare an Excel file (.xlsx or .xls) with student data</li>
            <li><strong>Required columns:</strong> roll_number, name, email</li>
            <li><strong>Optional columns:</strong> attendance_percentage, cgpa, semester, branch, phone, cf_handle, lc_username, cc_username</li>
            <li>The system will:
                <ul>
                    <li>Create new students if roll_number doesn't exist</li>
                    <li>Update existing students' admin-controlled fields (attendance, CGPA, etc.)</li>
                    <li>Set default password as roll_number for new students</li>
                </ul>
            </li>
        </ol>
        
        <div class="sample-table">
            <p><strong>Sample Excel Format:</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>roll_number</th>
                        <th>name</th>
                        <th>email</th>
                        <th>cgpa</th>
                        <th>attendance_percentage</th>
                        <th>semester</th>
                        <th>branch</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>21BCE001</td>
                        <td>John Doe</td>
                        <td>john@example.com</td>
                        <td>8.5</td>
                        <td>85</td>
                        <td>5</td>
                        <td>CSE</td>
                    </tr>
                    <tr>
                        <td>21BCE002</td>
                        <td>Jane Smith</td>
                        <td>jane@example.com</td>
                        <td>9.2</td>
                        <td>92</td>
                        <td>5</td>
                        <td>CSE</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="upload-card">
        <h2>Upload Excel File</h2>
        <p class="stats-text">Current students in database: <strong>{{ total_students }}</strong></p>
        
        <form method="POST" enctype="multipart/form-data" class="upload-form">
            <div class="file-input-wrapper">
                <input type="file" 
                       id="file" 
                       name="file" 
                       accept=".xlsx,.xls" 
                       required
                       class="file-input">
                <label for="file" class="file-label">
                    <span class="file-icon">üìÅ</span>
                    <span class="file-text">Choose Excel File</span>
                </label>
                <span id="file-name" class="file-name"></span>
            </div>
            
            <button type="submit" class="btn btn-primary">
                <span>üì§ Import Students</span>
            </button>
        </form>
    </div>
    
    <div class="warning-card">
        <h3>‚ö†Ô∏è Important Notes</h3>
        <ul>
            <li><strong>Students won't be able to edit:</strong> attendance_percentage, cgpa, semester, branch</li>
            <li><strong>Students can edit:</strong> name, email, phone, coding handles, social links, password</li>
            <li>Default password for new students is their roll_number (they should change it on first login)</li>
            <li>This will NOT delete existing students - it only creates or updates</li>
            <li>To delete students, use the dashboard interface</li>
        </ul>
    </div>
</div>

<script>
    // Display selected filename
    document.getElementById('file').addEventListener('change', function(e) {
        const fileName = e.target.files[0]?.name || 'No file chosen';
        document.getElementById('file-name').textContent = fileName;
    });
</script>

<style>
    .import-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }
    
    .page-header h1 {
        color: #2c3e50;
        margin: 0;
    }
    
    .btn {
        padding: 10px 20px;
        border-radius: 5px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s;
        border: none;
        cursor: pointer;
    }
    
    .btn-primary {
        background: #3498db;
        color: white;
        font-size: 16px;
    }
    
    .btn-primary:hover {
        background: #2980b9;
    }
    
    .btn-secondary {
        background: #95a5a6;
        color: white;
    }
    
    .info-card, .upload-card, .warning-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .info-card {
        border-left: 4px solid #3498db;
    }
    
    .warning-card {
        border-left: 4px solid #f39c12;
        background: #fff9f0;
    }
    
    .info-card h3, .warning-card h3 {
        color: #2c3e50;
        margin-top: 0;
        margin-bottom: 15px;
    }
    
    .info-card ol, .warning-card ul {
        margin: 10px 0;
        padding-left: 25px;
    }
    
    .info-card li, .warning-card li {
        margin-bottom: 10px;
        line-height: 1.6;
    }
    
    .sample-table {
        margin-top: 20px;
        overflow-x: auto;
    }
    
    .sample-table table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        font-size: 13px;
    }
    
    .sample-table th, .sample-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
    
    .sample-table th {
        background: #3498db;
        color: white;
        font-weight: 600;
    }
    
    .sample-table tr:nth-child(even) {
        background: #f8f9fa;
    }
    
    .upload-card h2 {
        color: #2c3e50;
        margin-top: 0;
        margin-bottom: 15px;
    }
    
    .stats-text {
        color: #7f8c8d;
        margin-bottom: 20px;
    }
    
    .upload-form {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .file-input-wrapper {
        position: relative;
    }
    
    .file-input {
        position: absolute;
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .file-label {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 15px 20px;
        background: #ecf0f1;
        border: 2px dashed #bdc3c7;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .file-label:hover {
        background: #e0e6e8;
        border-color: #95a5a6;
    }
    
    .file-icon {
        font-size: 24px;
    }
    
    .file-text {
        color: #2c3e50;
        font-weight: 500;
    }
    
    .file-name {
        display: block;
        margin-top: 10px;
        color: #7f8c8d;
        font-size: 14px;
    }
    
    .btn-primary {
        align-self: flex-start;
    }
    
    .btn-primary span {
        display: flex;
        align-items: center;
        gap: 8px;
    }
</style>
{% endblock %}
